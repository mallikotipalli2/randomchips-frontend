import{r as Be,b as de,S as Ge,i as Ae,s as He,z as Te,d as f,g as r,f as J,e as a,A as Re,n as y,B as Ne,a as Ke,t as Ce,C as ve,E as qe,c as Ye,m as We,l as ae,h as ht,k as I,j as h,o as Je,x as ee,p as ce,u as D,q as m,v as Qe,y as te,D as je,w as mt,J as gt,F as _t,N as Ve,G as Le,M as Ze}from"../chunks/D-id4_UX.js";import{g as vt,L as pt}from"../chunks/XHkGl_XW.js";import"../chunks/IHki7fMi.js";import{g as Me}from"../chunks/CuMgko4Z.js";import{i as bt,m as Fe,a as $e,e as yt,l as wt,r as kt,f as Ct,c as It,w as Dt,p as xt,s as Et,g as et}from"../chunks/DsuHmXpT.js";function tt(s){return s?.length!==void 0?s:Array.from(s)}function Tt(s,e){s.d(1),e.delete(s.key)}function Pt(s,e,t,l,n,i,o,g,c,_,w,v){let p=s.length,b=i.length,k=p;const x={};for(;k--;)x[s[k].key]=k;const F=[],E=new Map,G=new Map,V=[];for(k=b;k--;){const T=v(n,i,k),P=t(T);let M=o.get(P);M?V.push(()=>M.p(T,e)):(M=_(P,T),M.c()),E.set(P,F[k]=M),P in x&&G.set(P,Math.abs(k-x[P]))}const O=new Set,ue=new Set;function re(T){de(T,1),T.m(g,w),o.set(T.key,T),w=T.first,b--}for(;p&&b;){const T=F[b-1],P=s[p-1],M=T.key,R=P.key;T===P?(w=T.first,p--,b--):E.has(R)?!o.has(M)||O.has(M)?re(T):ue.has(R)?p--:G.get(M)>G.get(R)?(ue.add(M),re(T)):(O.add(R),p--):(c(P,o),p--)}for(;p--;){const T=s[p];E.has(T.key)||c(T,o)}for(;b;)re(F[b-1]);return Be(V),F}function zt(s){let e,t;return{c(){e=Ne("svg"),t=Ne("path"),this.h()},l(l){e=Re(l,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var n=y(e);t=Re(n,"path",{d:!0}),y(t).forEach(f),n.forEach(f),this.h()},h(){r(t,"d","M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"),r(e,"width",s[0]),r(e,"height",s[0]),r(e,"viewBox","0 0 24 24"),r(e,"fill","none"),r(e,"stroke",s[1]),r(e,"stroke-width","2")},m(l,n){J(l,e,n),a(e,t)},p(l,[n]){n&1&&r(e,"width",l[0]),n&1&&r(e,"height",l[0]),n&2&&r(e,"stroke",l[1])},i:Te,o:Te,d(l){l&&f(e)}}}function Vt(s,e,t){let{size:l=20}=e,{color:n="currentColor"}=e;return s.$$set=i=>{"size"in i&&t(0,l=i.size),"color"in i&&t(1,n=i.color)},[l,n]}class St extends Ge{constructor(e){super(),Ae(this,e,Vt,zt,He,{size:0,color:1})}}function jt(s){let e,t;return{c(){e=Ne("svg"),t=Ne("circle"),this.h()},l(l){e=Re(l,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0});var n=y(e);t=Re(n,"circle",{cx:!0,cy:!0,r:!0}),y(t).forEach(f),n.forEach(f),this.h()},h(){r(t,"cx","12"),r(t,"cy","12"),r(t,"r","10"),r(e,"width",s[0]),r(e,"height",s[0]),r(e,"viewBox","0 0 24 24"),r(e,"fill",s[1]),r(e,"stroke","none")},m(l,n){J(l,e,n),a(e,t)},p(l,[n]){n&1&&r(e,"width",l[0]),n&1&&r(e,"height",l[0]),n&2&&r(e,"fill",l[1])},i:Te,o:Te,d(l){l&&f(e)}}}function Mt(s,e,t){let{size:l=20}=e,{color:n="currentColor"}=e;return s.$$set=i=>{"size"in i&&t(0,l=i.size),"color"in i&&t(1,n=i.color)},[l,n]}class Rt extends Ge{constructor(e){super(),Ae(this,e,Mt,jt,He,{size:0,color:1})}}const{document:Oe,window:Nt}=vt;function lt(s,e,t){const l=s.slice();return l[40]=e[t],l}function st(s){let e,t="typing...";return{c(){e=m("div"),e.textContent=t,this.h()},l(l){e=h(l,"DIV",{class:!0,"data-svelte-h":!0}),ce(e)!=="svelte-152ov9z"&&(e.textContent=t),this.h()},h(){r(e,"class","text-xs text-gray-500 dark:text-gray-400 animate-pulse")},m(l,n){J(l,e,n)},d(l){l&&f(e)}}}function nt(s){let e,t,l,n,i,o="Say hello to start the conversation!",g;return l=new St({props:{size:24,color:"#9ca3af"}}),{c(){e=m("div"),t=m("div"),Qe(l.$$.fragment),n=D(),i=m("p"),i.textContent=o,this.h()},l(c){e=h(c,"DIV",{class:!0});var _=y(e);t=h(_,"DIV",{class:!0});var w=y(t);Je(l.$$.fragment,w),w.forEach(f),n=I(_),i=h(_,"P",{"data-svelte-h":!0}),ce(i)!=="svelte-30cx03"&&(i.textContent=o),_.forEach(f),this.h()},h(){r(t,"class","flex items-center justify-center mb-2"),r(e,"class","text-center text-gray-500 dark:text-gray-400 py-8")},m(c,_){J(c,e,_),a(e,t),We(l,t,null),a(e,n),a(e,i),g=!0},i(c){g||(de(l.$$.fragment,c),g=!0)},o(c){Ce(l.$$.fragment,c),g=!1},d(c){c&&f(e),Ke(l)}}}function Ut(s){let e,t,l,n,i=s[40].text+"",o,g,c,_,w=Ue(s[40].timestamp)+"",v,p,b=s[40].imageData&&it(s);return{c(){e=m("div"),t=m("div"),b&&b.c(),l=D(),n=m("p"),o=te(i),c=D(),_=m("div"),v=te(w),this.h()},l(k){e=h(k,"DIV",{class:!0});var x=y(e);t=h(x,"DIV",{class:!0});var F=y(t);b&&b.l(F),l=I(F),n=h(F,"P",{class:!0});var E=y(n);o=ee(E,i),E.forEach(f),F.forEach(f),c=I(x),_=h(x,"DIV",{class:!0});var G=y(_);v=ee(G,w),G.forEach(f),x.forEach(f),this.h()},h(){r(n,"class","break-words whitespace-pre-wrap"),r(t,"class",g=s[40].type==="sent"?"chat-bubble-self":"chat-bubble-other"),r(_,"class",p="text-xs text-gray-500 dark:text-gray-400 mt-1 "+(s[40].type==="sent"?"text-right":"text-left")),r(e,"class","max-w-xs lg:max-w-md")},m(k,x){J(k,e,x),a(e,t),b&&b.m(t,null),a(t,l),a(t,n),a(n,o),a(e,c),a(e,_),a(_,v)},p(k,x){k[40].imageData?b?b.p(k,x):(b=it(k),b.c(),b.m(t,l)):b&&(b.d(1),b=null),x[0]&8192&&i!==(i=k[40].text+"")&&ve(o,i),x[0]&8192&&g!==(g=k[40].type==="sent"?"chat-bubble-self":"chat-bubble-other")&&r(t,"class",g),x[0]&8192&&w!==(w=Ue(k[40].timestamp)+"")&&ve(v,w),x[0]&8192&&p!==(p="text-xs text-gray-500 dark:text-gray-400 mt-1 "+(k[40].type==="sent"?"text-right":"text-left"))&&r(_,"class",p)},d(k){k&&f(e),b&&b.d()}}}function Bt(s){let e,t,l="ðŸ“· requested a photo",n,i,o=Ue(s[40].timestamp)+"",g,c,_;function w(){return s[28](s[40])}return{c(){e=m("div"),t=m("button"),t.textContent=l,n=D(),i=m("div"),g=te(o),this.h()},l(v){e=h(v,"DIV",{class:!0});var p=y(e);t=h(p,"BUTTON",{class:!0,"data-svelte-h":!0}),ce(t)!=="svelte-c4llor"&&(t.textContent=l),n=I(p),i=h(p,"DIV",{class:!0});var b=y(i);g=ee(b,o),b.forEach(f),p.forEach(f),this.h()},h(){r(t,"class","chat-bubble-other hover:opacity-80 transition-opacity cursor-pointer"),r(i,"class","text-xs text-gray-500 dark:text-gray-400 mt-1 text-left"),r(e,"class","max-w-xs lg:max-w-md")},m(v,p){J(v,e,p),a(e,t),a(e,n),a(e,i),a(i,g),c||(_=ae(t,"click",w),c=!0)},p(v,p){s=v,p[0]&8192&&o!==(o=Ue(s[40].timestamp)+"")&&ve(g,o)},d(v){v&&f(e),c=!1,_()}}}function Ft(s){let e,t=s[40].text+"",l;return{c(){e=m("div"),l=te(t),this.h()},l(n){e=h(n,"DIV",{class:!0});var i=y(e);l=ee(i,t),i.forEach(f),this.h()},h(){r(e,"class","text-xs text-gray-500 dark:text-gray-400 bg-gray-200 dark:bg-gray-700 px-3 py-1 rounded-full max-w-md text-center")},m(n,i){J(n,e,i),a(e,l)},p(n,i){i[0]&8192&&t!==(t=n[40].text+"")&&ve(l,t)},d(n){n&&f(e)}}}function it(s){let e,t,l,n,i;function o(){return s[29](s[40])}return{c(){e=m("button"),t=m("img"),this.h()},l(g){e=h(g,"BUTTON",{type:!0,class:!0});var c=y(e);t=h(c,"IMG",{src:!0,alt:!0,class:!0,loading:!0}),c.forEach(f),this.h()},h(){Ve(t.src,l=s[40].imageData)||r(t,"src",l),r(t,"alt","Click to view full size"),r(t,"class","max-w-full h-auto rounded-lg mb-2 max-h-64 object-contain hover:opacity-90 transition-opacity"),r(t,"loading","lazy"),r(e,"type","button"),r(e,"class","block max-w-full focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-lg")},m(g,c){J(g,e,c),a(e,t),n||(i=ae(e,"click",o),n=!0)},p(g,c){s=g,c[0]&8192&&!Ve(t.src,l=s[40].imageData)&&r(t,"src",l)},d(g){g&&f(e),n=!1,i()}}}function at(s,e){let t,l,n;function i(c,_){return c[40].type==="system"?Ft:c[40].type==="photo-request"?Bt:Ut}let o=i(e),g=o(e);return{key:s,first:null,c(){t=m("div"),g.c(),l=D(),this.h()},l(c){t=h(c,"DIV",{class:!0});var _=y(t);g.l(_),l=I(_),_.forEach(f),this.h()},h(){r(t,"class",n="flex "+(e[40].type==="sent"?"justify-end":e[40].type==="system"?"justify-center":"justify-start")),this.first=t},m(c,_){J(c,t,_),g.m(t,null),a(t,l)},p(c,_){e=c,o===(o=i(e))&&g?g.p(e,_):(g.d(1),g=o(e),g&&(g.c(),g.m(t,l))),_[0]&8192&&n!==(n="flex "+(e[40].type==="sent"?"justify-end":e[40].type==="system"?"justify-center":"justify-start"))&&r(t,"class",n)},d(c){c&&f(t),g.d()}}}function rt(s){let e,t,l,n,i="Send Image",o,g,c,_,w,v,p,b,k="File:",x,F=s[4]?.name+"",E,G,V,O,ue="Size:",re,T=(s[4]?.size/1024/1024).toFixed(2)+"",P,M,R,oe,le,Q="Type:",pe,fe=s[4]?.type+"",he,me,A,Y,Ie="Transfer:",we,Z=s[12]?"P2P (Direct)":"Server Relay",be,d,H,L,K,q,se,Pe,N,U=s[7]?"Wait...":"Cancel",ke,ne,B,X,C=!s[7]&&ot(s),u=s[7]&&ct();const z=[qt,Ot],j=[];function Se(S,W){return S[7]?0:1}return q=Se(s),se=j[q]=z[q](s),{c(){e=m("div"),t=m("div"),l=m("div"),n=m("h3"),n.textContent=i,o=D(),C&&C.c(),g=D(),c=m("img"),w=D(),v=m("div"),p=m("div"),b=m("strong"),b.textContent=k,x=D(),E=te(F),G=D(),V=m("div"),O=m("strong"),O.textContent=ue,re=D(),P=te(T),M=te(" MB"),R=D(),oe=m("div"),le=m("strong"),le.textContent=Q,pe=D(),he=te(fe),me=D(),A=m("div"),Y=m("strong"),Y.textContent=Ie,we=D(),be=te(Z),d=D(),u&&u.c(),H=D(),L=m("div"),K=m("button"),se.c(),Pe=D(),N=m("button"),ke=te(U),this.h()},l(S){e=h(S,"DIV",{class:!0});var W=y(e);t=h(W,"DIV",{class:!0});var $=y(t);l=h($,"DIV",{class:!0});var De=y(l);n=h(De,"H3",{class:!0,"data-svelte-h":!0}),ce(n)!=="svelte-17c0szm"&&(n.textContent=i),o=I(De),C&&C.l(De),De.forEach(f),g=I($),c=h($,"IMG",{src:!0,alt:!0,class:!0}),w=I($),v=h($,"DIV",{class:!0});var ie=y(v);p=h(ie,"DIV",{});var ge=y(p);b=h(ge,"STRONG",{"data-svelte-h":!0}),ce(b)!=="svelte-18ykwme"&&(b.textContent=k),x=I(ge),E=ee(ge,F),ge.forEach(f),G=I(ie),V=h(ie,"DIV",{});var ye=y(V);O=h(ye,"STRONG",{"data-svelte-h":!0}),ce(O)!=="svelte-1g9uum1"&&(O.textContent=ue),re=I(ye),P=ee(ye,T),M=ee(ye," MB"),ye.forEach(f),R=I(ie),oe=h(ie,"DIV",{});var xe=y(oe);le=h(xe,"STRONG",{"data-svelte-h":!0}),ce(le)!=="svelte-1y9dw9w"&&(le.textContent=Q),pe=I(xe),he=ee(xe,fe),xe.forEach(f),me=I(ie),A=h(ie,"DIV",{});var _e=y(A);Y=h(_e,"STRONG",{"data-svelte-h":!0}),ce(Y)!=="svelte-i58llj"&&(Y.textContent=Ie),we=I(_e),be=ee(_e,Z),_e.forEach(f),d=I(ie),u&&u.l(ie),ie.forEach(f),H=I($),L=h($,"DIV",{class:!0});var Ee=y(L);K=h(Ee,"BUTTON",{class:!0});var ze=y(K);se.l(ze),ze.forEach(f),Pe=I(Ee),N=h(Ee,"BUTTON",{class:!0});var Xe=y(N);ke=ee(Xe,U),Xe.forEach(f),Ee.forEach(f),$.forEach(f),W.forEach(f),this.h()},h(){r(n,"class","text-lg font-semibold"),r(l,"class","flex justify-between items-center mb-4"),Ve(c.src,_=s[5])||r(c,"src",_),r(c,"alt","Preview"),r(c,"class","w-full h-auto rounded-lg mb-4 max-h-64 object-contain"),r(v,"class","text-sm text-gray-600 dark:text-gray-400 mb-4"),K.disabled=s[7],r(K,"class","btn-primary flex-1 disabled:opacity-50 disabled:cursor-not-allowed"),N.disabled=s[7],r(N,"class","btn-secondary flex-1 disabled:opacity-50 disabled:cursor-not-allowed"),r(L,"class","flex space-x-3"),r(t,"class","bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-auto"),r(e,"class","fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4")},m(S,W){J(S,e,W),a(e,t),a(t,l),a(l,n),a(l,o),C&&C.m(l,null),a(t,g),a(t,c),a(t,w),a(t,v),a(v,p),a(p,b),a(p,x),a(p,E),a(v,G),a(v,V),a(V,O),a(V,re),a(V,P),a(V,M),a(v,R),a(v,oe),a(oe,le),a(oe,pe),a(oe,he),a(v,me),a(v,A),a(A,Y),a(A,we),a(A,be),a(v,d),u&&u.m(v,null),a(t,H),a(t,L),a(L,K),j[q].m(K,null),a(L,Pe),a(L,N),a(N,ke),ne=!0,B||(X=[ae(K,"click",s[23]),ae(N,"click",s[22])],B=!0)},p(S,W){S[7]?C&&(C.d(1),C=null):C?C.p(S,W):(C=ot(S),C.c(),C.m(l,null)),(!ne||W[0]&32&&!Ve(c.src,_=S[5]))&&r(c,"src",_),(!ne||W[0]&16)&&F!==(F=S[4]?.name+"")&&ve(E,F),(!ne||W[0]&16)&&T!==(T=(S[4]?.size/1024/1024).toFixed(2)+"")&&ve(P,T),(!ne||W[0]&16)&&fe!==(fe=S[4]?.type+"")&&ve(he,fe),(!ne||W[0]&4096)&&Z!==(Z=S[12]?"P2P (Direct)":"Server Relay")&&ve(be,Z),S[7]?u||(u=ct(),u.c(),u.m(v,null)):u&&(u.d(1),u=null);let $=q;q=Se(S),q!==$&&(Le(),Ce(j[$],1,1,()=>{j[$]=null}),qe(),se=j[q],se||(se=j[q]=z[q](S),se.c()),de(se,1),se.m(K,null)),(!ne||W[0]&128)&&(K.disabled=S[7]),(!ne||W[0]&128)&&U!==(U=S[7]?"Wait...":"Cancel")&&ve(ke,U),(!ne||W[0]&128)&&(N.disabled=S[7])},i(S){ne||(de(se),ne=!0)},o(S){Ce(se),ne=!1},d(S){S&&f(e),C&&C.d(),u&&u.d(),j[q].d(),B=!1,Be(X)}}}function ot(s){let e,t="Ã—",l,n;return{c(){e=m("button"),e.textContent=t,this.h()},l(i){e=h(i,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ce(e)!=="svelte-unnaad"&&(e.textContent=t),this.h()},h(){r(e,"class","text-gray-500 hover:text-gray-700 text-xl"),r(e,"title","Close")},m(i,o){J(i,e,o),l||(n=ae(e,"click",s[22]),l=!0)},p:Te,d(i){i&&f(e),l=!1,n()}}}function ct(s){let e,t="<strong>Status:</strong> Processing image...";return{c(){e=m("div"),e.innerHTML=t,this.h()},l(l){e=h(l,"DIV",{class:!0,"data-svelte-h":!0}),ce(e)!=="svelte-3gfnum"&&(e.innerHTML=t),this.h()},h(){r(e,"class","text-blue-600 dark:text-blue-400 mt-2")},m(l,n){J(l,e,n)},d(l){l&&f(e)}}}function Ot(s){let e;return{c(){e=te("Send Image")},l(t){e=ee(t,"Send Image")},m(t,l){J(t,e,l)},i:Te,o:Te,d(t){t&&f(e)}}}function qt(s){let e,t,l,n;return t=new pt({props:{size:16,class:"animate-spin mr-2"}}),{c(){e=m("span"),Qe(t.$$.fragment),l=te(`\r
                Sending...`),this.h()},l(i){e=h(i,"SPAN",{class:!0});var o=y(e);Je(t.$$.fragment,o),l=ee(o,`\r
                Sending...`),o.forEach(f),this.h()},h(){r(e,"class","flex items-center justify-center")},m(i,o){J(i,e,o),We(t,e,null),a(e,l),n=!0},i(i){n||(de(t.$$.fragment,i),n=!0)},o(i){Ce(t.$$.fragment,i),n=!1},d(i){i&&f(e),Ke(t)}}}function ut(s){let e,t,l,n="Ã—",i,o,g,c,_;return{c(){e=m("div"),t=m("div"),l=m("button"),l.textContent=n,i=D(),o=m("img"),this.h()},l(w){e=h(w,"DIV",{class:!0});var v=y(e);t=h(v,"DIV",{class:!0});var p=y(t);l=h(p,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ce(l)!=="svelte-jplty3"&&(l.textContent=n),i=I(p),o=h(p,"IMG",{src:!0,alt:!0,class:!0}),p.forEach(f),v.forEach(f),this.h()},h(){r(l,"class","absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full w-10 h-10 flex items-center justify-center hover:bg-opacity-70 z-10"),r(l,"title","Close (Press Escape)"),Ve(o.src,g=s[9])||r(o,"src",g),r(o,"alt","Full size image"),r(o,"class","max-w-full max-h-full object-contain"),r(t,"class","relative max-w-full max-h-full"),r(e,"class","fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4")},m(w,v){J(w,e,v),a(e,t),a(t,l),a(t,i),a(t,o),c||(_=[ae(l,"click",s[25]),ae(o,"click",s[25])],c=!0)},p(w,v){v[0]&512&&!Ve(o.src,g=w[9])&&r(o,"src",g)},d(w){w&&f(e),c=!1,Be(_)}}}function ft(s){let e,t=s[0].length+"",l,n;return{c(){e=m("div"),l=te(t),n=te("/1000 characters"),this.h()},l(i){e=h(i,"DIV",{class:!0});var o=y(e);l=ee(o,t),n=ee(o,"/1000 characters"),o.forEach(f),this.h()},h(){r(e,"class","text-xs text-gray-500 dark:text-gray-400 mb-2 text-right")},m(i,o){J(i,e,o),a(e,l),a(e,n)},p(i,o){o[0]&1&&t!==(t=i[0].length+"")&&ve(l,t)},d(i){i&&f(e)}}}function Lt(s){let e,t,l,n,i,o,g,c,_,w,v,p,b=(s[14]?.name||"Partner")+"",k,x,F,E,G,V=[],O=new Map,ue,re,T,P,M,R,oe,le,Q,pe,fe,he,me,A,Y,Ie="New Chat",we,Z,be,d,H,L,K="Report",q,se,Pe;Oe.title=e="Chat with "+(s[14]?.name||"Partner")+" - RandomChips",_=new Rt({props:{size:12,color:"#10b981"}});let N=s[6]&&st(),U=s[13].length===0&&nt(),ke=tt(s[13]);const ne=u=>u[40].id;for(let u=0;u<ke.length;u+=1){let z=lt(s,ke,u),j=ne(z);O.set(j,V[u]=at(j,z))}let B=s[3]&&rt(s),X=s[8]&&s[9]&&ut(s),C=s[0].length>800&&ft(s);return{c(){t=D(),l=m("input"),n=D(),i=m("div"),o=m("div"),g=m("div"),c=m("div"),Qe(_.$$.fragment),w=D(),v=m("div"),p=m("h2"),k=te(b),x=D(),N&&N.c(),F=D(),E=m("div"),U&&U.c(),G=D();for(let u=0;u<V.length;u+=1)V[u].c();ue=D(),B&&B.c(),re=D(),X&&X.c(),T=D(),P=m("div"),M=m("div"),R=m("input"),le=D(),Q=m("button"),pe=te("Send"),he=D(),C&&C.c(),me=D(),A=m("div"),Y=m("button"),Y.textContent=Ie,we=D(),Z=m("button"),be=te("Req Photo"),H=D(),L=m("button"),L.textContent=K,this.h()},l(u){ht("svelte-1dbow3a",Oe.head).forEach(f),t=I(u),l=h(u,"INPUT",{type:!0,accept:!0,class:!0}),n=I(u),i=h(u,"DIV",{class:!0});var j=y(i);o=h(j,"DIV",{class:!0});var Se=y(o);g=h(Se,"DIV",{class:!0});var S=y(g);c=h(S,"DIV",{class:!0});var W=y(c);Je(_.$$.fragment,W),w=I(W),v=h(W,"DIV",{});var $=y(v);p=h($,"H2",{class:!0});var De=y(p);k=ee(De,b),De.forEach(f),x=I($),N&&N.l($),$.forEach(f),W.forEach(f),S.forEach(f),Se.forEach(f),F=I(j),E=h(j,"DIV",{class:!0});var ie=y(E);U&&U.l(ie),G=I(ie);for(let ze=0;ze<V.length;ze+=1)V[ze].l(ie);ie.forEach(f),ue=I(j),B&&B.l(j),re=I(j),X&&X.l(j),T=I(j),P=h(j,"DIV",{class:!0});var ge=y(P);M=h(ge,"DIV",{class:!0});var ye=y(M);R=h(ye,"INPUT",{placeholder:!0,maxlength:!0,class:!0}),le=I(ye),Q=h(ye,"BUTTON",{class:!0});var xe=y(Q);pe=ee(xe,"Send"),xe.forEach(f),ye.forEach(f),he=I(ge),C&&C.l(ge),me=I(ge),A=h(ge,"DIV",{class:!0});var _e=y(A);Y=h(_e,"BUTTON",{class:!0,"data-svelte-h":!0}),ce(Y)!=="svelte-gf5p2z"&&(Y.textContent=Ie),we=I(_e),Z=h(_e,"BUTTON",{class:!0});var Ee=y(Z);be=ee(Ee,"Req Photo"),Ee.forEach(f),H=I(_e),L=h(_e,"BUTTON",{class:!0,"data-svelte-h":!0}),ce(L)!=="svelte-znhcfa"&&(L.textContent=K),_e.forEach(f),ge.forEach(f),j.forEach(f),this.h()},h(){r(l,"type","file"),r(l,"accept","image/jpeg,image/jpg,image/png,image/webp"),r(l,"class","hidden"),r(p,"class","text-lg font-semibold"),r(c,"class","flex items-center space-x-3"),r(g,"class","flex items-center justify-between"),r(o,"class","bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-4"),r(E,"class","flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-gray-800"),r(R,"placeholder","Type a message..."),R.disabled=oe=!s[11]||!s[10],r(R,"maxlength","1000"),r(R,"class","flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-brand-blue focus:border-transparent placeholder-gray-500 dark:placeholder-gray-400 disabled:opacity-50 disabled:cursor-not-allowed"),Q.disabled=fe=!s[0].trim()||!s[11]||!s[10],r(Q,"class","btn-secondary disabled:opacity-50 disabled:cursor-not-allowed"),r(M,"class","flex space-x-2 mb-3"),r(Y,"class","btn-secondary text-sm py-2 px-4"),Z.disabled=d=!s[11]||!s[10],r(Z,"class","btn-info text-sm py-2 px-4 disabled:opacity-50"),r(L,"class","btn-danger text-sm py-2 px-4"),r(A,"class","flex space-x-2 text-sm"),r(P,"class","bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 p-4"),r(i,"class","flex flex-col h-[calc(100vh-73px)]")},m(u,z){J(u,t,z),J(u,l,z),s[27](l),J(u,n,z),J(u,i,z),a(i,o),a(o,g),a(g,c),We(_,c,null),a(c,w),a(c,v),a(v,p),a(p,k),a(v,x),N&&N.m(v,null),a(i,F),a(i,E),U&&U.m(E,null),a(E,G);for(let j=0;j<V.length;j+=1)V[j]&&V[j].m(E,null);s[30](E),a(i,ue),B&&B.m(i,null),a(i,re),X&&X.m(i,null),a(i,T),a(i,P),a(P,M),a(M,R),Ye(R,s[0]),a(M,le),a(M,Q),a(Q,pe),a(P,he),C&&C.m(P,null),a(P,me),a(P,A),a(A,Y),a(A,we),a(A,Z),a(Z,be),a(A,H),a(A,L),q=!0,se||(Pe=[ae(Nt,"keydown",s[26]),ae(l,"change",s[21]),ae(R,"input",s[31]),ae(R,"keypress",s[16]),ae(Q,"click",s[15]),ae(Y,"click",s[17]),ae(Z,"click",s[18]),ae(L,"click",s[19])],se=!0)},p(u,z){(!q||z[0]&16384)&&e!==(e="Chat with "+(u[14]?.name||"Partner")+" - RandomChips")&&(Oe.title=e),(!q||z[0]&16384)&&b!==(b=(u[14]?.name||"Partner")+"")&&ve(k,b),u[6]?N||(N=st(),N.c(),N.m(v,null)):N&&(N.d(1),N=null),u[13].length===0?U?z[0]&8192&&de(U,1):(U=nt(),U.c(),de(U,1),U.m(E,G)):U&&(Le(),Ce(U,1,1,()=>{U=null}),qe()),z[0]&17833984&&(ke=tt(u[13]),V=Pt(V,z,ne,1,u,ke,O,E,Tt,at,null,lt)),u[3]?B?(B.p(u,z),z[0]&8&&de(B,1)):(B=rt(u),B.c(),de(B,1),B.m(i,re)):B&&(Le(),Ce(B,1,1,()=>{B=null}),qe()),u[8]&&u[9]?X?X.p(u,z):(X=ut(u),X.c(),X.m(i,T)):X&&(X.d(1),X=null),(!q||z[0]&3072&&oe!==(oe=!u[11]||!u[10]))&&(R.disabled=oe),z[0]&1&&R.value!==u[0]&&Ye(R,u[0]),(!q||z[0]&3073&&fe!==(fe=!u[0].trim()||!u[11]||!u[10]))&&(Q.disabled=fe),u[0].length>800?C?C.p(u,z):(C=ft(u),C.c(),C.m(P,me)):C&&(C.d(1),C=null),(!q||z[0]&3072&&d!==(d=!u[11]||!u[10]))&&(Z.disabled=d)},i(u){q||(de(_.$$.fragment,u),de(U),de(B),q=!0)},o(u){Ce(_.$$.fragment,u),Ce(U),Ce(B),q=!1},d(u){u&&(f(t),f(l),f(n),f(i)),s[27](null),Ke(_),N&&N.d(),U&&U.d();for(let z=0;z<V.length;z+=1)V[z].d();s[30](null),B&&B.d(),X&&X.d(),C&&C.d(),se=!1,Be(Pe)}}}let dt=3;function Gt(s){return new Promise((e,t)=>{const l=new FileReader;l.onload=n=>e(n.target.result),l.onerror=n=>t(new Error("Failed to read file")),l.readAsDataURL(s)})}function Ue(s=Date.now()){return new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function At(s,e,t){let l,n,i,o,g;je(s,$e,d=>t(10,l=d)),je(s,It,d=>t(11,n=d)),je(s,Dt,d=>t(12,i=d)),je(s,Fe,d=>t(13,o=d)),je(s,xt,d=>t(14,g=d));let c="",_,w,v=!1,p=null,b="",k=!1,x,F=0,E=!1,G=!1,V=null,O=null;mt(()=>{if(typeof window<"u"&&window.location.pathname!=="/"&&!document.referrer.includes(window.location.origin)){Me("/");return}bt(),Fe.set([]);const d=$e.subscribe(K=>{K||Me("/")}),H=Fe.subscribe(K=>{gt().then(()=>{_&&t(1,_.scrollTop=_.scrollHeight,_)})}),L=yt.subscribe(K=>{K==="poor"&&F<dt&&setTimeout(()=>{F++,console.log(`Attempting to improve connection (${F}/${dt})`)},2e3)});return()=>{d(),H(),L()}}),_t(()=>{Q(),x&&clearTimeout(x)});function ue(){if(!c.trim()||!n||!l)return;const d=o[o.length-1];d&&d.type==="sent"&&d.text===c.trim()&&Date.now()-new Date(d.timestamp).getTime()<2e3||(Et(c),t(0,c=""),t(6,k=!1),x&&clearTimeout(x))}function re(d){d.key==="Enter"&&!d.shiftKey?(d.preventDefault(),ue()):(t(6,k=!0),x&&clearTimeout(x),x=setTimeout(()=>{t(6,k=!1)},2e3))}function T(){confirm("Are you sure you want to start a new chat? this will disconnect from the current Chip.")&&(Q(),wt(),Me("/waiting"))}function P(){console.log("Req Photo button clicked"),kt()}function M(){confirm("Are you sure you want to report this user? This will end the chat and may help improve the platform.")&&(Q(),Ct(),Me("/"))}function R(d){if(!n||!l){alert("Connection lost. Please try again.");return}console.log("Photo request clicked:",d),O=d,w.click()}function oe(d=null){let H;if(d&&d.target?H=d.target.files[0]:d instanceof DataTransferEvent&&(H=d.dataTransfer.files[0]),!H){O=null;return}const L=["image/jpeg","image/jpg","image/png","image/webp"],K=20*1024*1024,q=10*1024*1024;if(!L.includes(H.type)){alert("Please select a valid image file (JPEG, PNG, or WebP only). GIF files are not allowed."),le(),O=null;return}if(H.size>K){alert("File size must be less than 20MB. Please choose a smaller image or compress it."),le(),O=null;return}if(H.size>q&&!confirm(`This image is ${(H.size/1024/1024).toFixed(1)}MB. Large files take longer to send and may fail on slow connections. Continue?`)){le(),O=null;return}Q(),t(4,p=H),t(5,b=URL.createObjectURL(H)),t(3,v=!0),t(7,E=!1)}function le(){w&&t(2,w.value="",w)}function Q(){b&&URL.revokeObjectURL(b),t(4,p=null),t(5,b=""),t(3,v=!1),t(7,E=!1),le()}function pe(){E&&!confirm("Image is being sent. Are you sure you want to cancel?")||(O=null,Q())}async function fe(){if(!(!p||E)){if(!n||!l){alert("Connection lost. Please try again.");return}t(7,E=!0);try{const d=await Gt(p);O?(et(p,d,O),O=null):et(p,d),setTimeout(()=>{Q()},500)}catch(d){console.error("Error processing image:",d),alert("Failed to process image. Please try again."),t(7,E=!1),O=null}}}function he(d){t(9,V=d),t(8,G=!0)}function me(){t(8,G=!1),t(9,V=null)}function A(d){d.key==="Escape"&&(G?me():v&&!E&&pe())}function Y(d){Ze[d?"unshift":"push"](()=>{w=d,t(2,w)})}const Ie=d=>R(d.id),we=d=>he(d.imageData);function Z(d){Ze[d?"unshift":"push"](()=>{_=d,t(1,_)})}function be(){c=this.value,t(0,c)}return[c,_,w,v,p,b,k,E,G,V,l,n,i,o,g,ue,re,T,P,M,R,oe,pe,fe,he,me,A,Y,Ie,we,Z,be]}class Xt extends Ge{constructor(e){super(),Ae(this,e,At,Lt,He,{},null,[-1,-1])}}export{Xt as component};
